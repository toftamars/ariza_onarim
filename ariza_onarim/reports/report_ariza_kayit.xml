<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <template id="report_ariza_kayit">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="o">
                <t t-call="ariza_onarim.report_ariza_kayit_document" t-lang="o.env.lang"/>
            </t>
        </t>
    </template>

    <template id="report_ariza_kayit_document">
        <t t-call="web.external_layout">
            <style>
                /* Tek sayfa boyutlandırma - kompakt tasarım */
                @page {
                    size: A4;
                    margin: 0.5cm;
                }
                
                /* Tüm sayfa geçişlerini engelle */
                * {
                    page-break-after: avoid !important;
                    page-break-before: avoid !important;
                    page-break-inside: avoid !important;
                }
                
                /* Body ve html için sayfa geçişi engelleme */
                body, html {
                    page-break-after: avoid !important;
                    page-break-before: avoid !important;
                    font-size: 11px !important;
                }
                
                /* External layout için sayfa geçişi engelleme */
                .o_report_layout_standard {
                    page-break-after: avoid !important;
                    page-break-before: avoid !important;
                }
                
                /* Boş sayfa engelleme */
                .o_report_layout_standard:after,
                .o_report_layout_standard:before {
                    display: none !important;
                }
                
                /* Sayfa numarası font boyutunu küçült */
                .page-number {
                    font-size: 8px !important;
                }
                
                /* Sayfa sonunda boşluk bırakma */
                .page {
                    page-break-after: avoid !important;
                    page-break-before: avoid !important;
                }
                
                /* Boş sayfa engelleme - ek kurallar */
                .o_report_layout_standard > *:last-child {
                    page-break-after: avoid !important;
                }
                
                /* Tüm div'ler için sayfa geçişi engelleme */
                div {
                    page-break-after: avoid !important;
                    page-break-before: avoid !important;
                }
                
                /* Düzenli ve toplu tasarım - boyutlar daha da büyütüldü */
                .row {
                    margin-bottom: 12px !important;
                }
                
                .mb-4 {
                    margin-bottom: 12px !important;
                }
                
                h2 {
                    font-size: 20px !important;
                    margin-bottom: 12px !important;
                    text-align: center !important;
                    font-weight: bold !important;
                }
                
                h5 {
                    font-size: 16px !important;
                    margin-bottom: 8px !important;
                    font-weight: bold !important;
                    color: #2c3e50 !important;
                }
                
                .table {
                    font-size: 13px !important;
                    margin-bottom: 12px !important;
                    border-collapse: collapse !important;
                }
                
                .table td {
                    padding: 6px 10px !important;
                    border: 1px solid #ddd !important;
                }
                
                .table th {
                    padding: 6px 10px !important;
                    border: 1px solid #ddd !important;
                    background-color: #f8f9fa !important;
                    font-weight: bold !important;
                }
                
                .gonderi-adresi {
                    padding: 12px !important;
                    font-size: 13px !important;
                    margin-bottom: 12px !important;
                    border-radius: 5px !important;
                }
                
                .gonderi-adresi strong {
                    font-size: 15px !important;
                }
                
                strong {
                    color: #2c3e50 !important;
                }
            </style>
            
            <!-- Analitik Hesap Bilgileri - Üst Kısım -->
            <div class="row mb-4">
                <div class="col-6">
                    <div class="text-left" style="border: 2px solid #000; background-color: #f0f0f0; font-weight: bold; padding: 10px;">
                        <t t-if="o.analitik_hesap_id and o.analitik_hesap_id.adres">
                            <div style="font-size: 14px; font-weight: bold;"><t t-esc="o.analitik_hesap_id.adres"/></div>
                        </t>
                        <t t-elif="o.analitik_hesap_id and o.analitik_hesap_id.partner_id and o.analitik_hesap_id.partner_id.street">
                            <div style="font-size: 14px; font-weight: bold;">
                                <t t-esc="(o.analitik_hesap_id.name.replace('Perakende - ', '') + ' Mağaza') if o.analitik_hesap_id.name else ''"/><br/>
                                <t t-esc="o.analitik_hesap_id.partner_id.street or ''"/>
                                <t t-if="o.analitik_hesap_id.partner_id.street2"><br/><t t-esc="o.analitik_hesap_id.partner_id.street2"/></t>
                                <t t-if="o.analitik_hesap_id.partner_id.city"><br/><t t-esc="o.analitik_hesap_id.partner_id.city"/></t>
                                <t t-if="o.analitik_hesap_id.partner_id.state_id"><br/><t t-esc="o.analitik_hesap_id.partner_id.state_id.name"/></t>
                                <t t-if="o.analitik_hesap_id.partner_id.zip"><br/><t t-esc="o.analitik_hesap_id.partner_id.zip"/></t>
                                <t t-if="o.analitik_hesap_id.partner_id.country_id"><br/><t t-esc="o.analitik_hesap_id.partner_id.country_id.name"/></t>
                            </div>
                        </t>
                        <t t-elif="o.analitik_hesap_id and o.analitik_hesap_id.name">
                            <div style="font-size: 14px; font-weight: bold;">
                                <t t-esc="(o.analitik_hesap_id.name.replace('Perakende - ', '') + ' Mağaza') if o.analitik_hesap_id.name else ''"/>
                                <!-- Zuhal Dış Ticaret A.Ş. altındaki kontaklarda analitik hesap adresini ara -->
                                <t t-set="zuhal_partner" t-value="env['res.partner'].search([('name', '=', 'Zuhal Dış Ticaret A.Ş.')], limit=1)"/>
                                <t t-if="zuhal_partner">
                                    <t t-set="magaza_kontak" t-value="env['res.partner'].search([('parent_id', '=', zuhal_partner.id), ('name', 'ilike', o.analitik_hesap_id.name.replace('Perakende - ', ''))], limit=1)"/>
                                    <t t-if="magaza_kontak">
                                        <br/><t t-esc="magaza_kontak.street or ''"/>
                                        <t t-if="magaza_kontak.street2"><br/><t t-esc="magaza_kontak.street2"/></t>
                                        <t t-if="magaza_kontak.city"><br/><t t-esc="magaza_kontak.city"/></t>
                                        <t t-if="magaza_kontak.state_id"><br/><t t-esc="magaza_kontak.state_id.name"/></t>
                                        <t t-if="magaza_kontak.zip"><br/><t t-esc="magaza_kontak.zip"/></t>
                                        <t t-if="magaza_kontak.country_id"><br/><t t-esc="magaza_kontak.country_id.name"/></t>
                                    </t>
                                </t>
                            </div>
                        </t>
                        <t t-elif="o.analitik_hesap_id and o.analitik_hesap_id.name">
                            <div style="font-size: 14px; font-weight: bold;">
                                <t t-esc="(o.analitik_hesap_id.name.replace('Perakende - ', '') + ' Mağaza') if o.analitik_hesap_id.name else ''"/>
                            </div>
                        </t>
                        <t t-else="">
                            <div t-field="company.name"/><br/>
                            <div t-field="company.partner_id" t-options='{"widget": "contact", "fields": ["address"], "no_marker": true}'/>
                        </t>
                        <t t-if="o.analitik_hesap_id and o.analitik_hesap_id.telefon">
                            <div>Tel: <t t-esc="o.analitik_hesap_id.telefon"/></div>
                        </t>
                        <t t-if="o.analitik_hesap_id and o.analitik_hesap_id.email">
                            <div>Email: <t t-esc="o.analitik_hesap_id.email"/></div>
                        </t>
                    </div>
                </div>
                <div class="col-6">
                    <div class="text-right gonderi-adresi" style="border: 2px solid #000; background-color: #f0f0f0; font-weight: bold;">
                        <strong style="color: #000;">GÖNDERİ ADRESİ:</strong><br/>
                        <!-- Onarımı Tamamla ve SMS Gönder sonrası (teslim_edildi durumu) -->
                        <t t-if="o.state == 'teslim_edildi'">
                            <!-- Teslim Mağazası seçilmişse -->
                            <t t-if="o.teslim_alan == 'Teslim Mağazası' and o.teslim_magazasi_id">
                                <t t-esc="o.teslim_magazasi_id.name"/><br/>
                                <t t-esc="o.teslim_magazasi_id.street or ''"/><br/>
                                <t t-esc="o.teslim_magazasi_id.city or ''"/>, <t t-esc="o.teslim_magazasi_id.country_id.name or ''"/>
                            </t>
                            <!-- Adrese Gönderim seçilmişse -->
                            <t t-elif="o.teslim_alan == 'Adrese Gönderim' and o.partner_id">
                                <t t-esc="o.partner_id.name"/><br/>
                                <t t-esc="o.partner_id.street or ''"/><br/>
                                <t t-if="o.partner_id.street2" t-esc="o.partner_id.street2"/><br/>
                                <t t-esc="o.partner_id.city or ''"/>, <t t-esc="o.partner_id.country_id.name or ''"/>
                            </t>
                            <!-- Eğer teslim alanı belirlenmemişse teknik servis adresi -->
                            <t t-else="">
                                <t t-if="o.teknik_servis == 'DTL BEYOĞLU'">
                                    DTL BEYOĞLU<br/>
                                    Şahkulu mh. Nakkas çıkmazı No: 1/1 No:10-46 / 47<br/>
                                    Beyoğlu, İstanbul
                                </t>
                                <t t-elif="o.teknik_servis == 'DTL OKMEYDANI'">
                                    DTL OKMEYDANI<br/>
                                    MAHMUT ŞEVKET PAŞA MAH. ŞAHİNKAYA SOK NO 31 OKMEYDANI<br/>
                                    İstanbul
                                </t>
                                                            <t t-elif="o.teknik_servis == 'ZUHAL ARIZA DEPO'">
                                ZUHAL ARIZA DEPO<br/>
                                Halkalı merkez mh. Dereboyu cd. No:8/B<br/>
                                İstanbul
                            </t>
                                <t t-elif="o.teknik_servis == 'ZUHAL NEFESLİ'">
                                    ZUHAL NEFESLİ<br/>
                                    Şahkulu, Galip Dede Cd. No:33, 34421 Beyoğlu/İstanbul
                                </t>
                                <t t-elif="o.teknik_servis == 'TEDARİKÇİ' and o.tedarikci_id">
                                    <t t-esc="o.tedarikci_id.name"/><br/>
                                    <t t-esc="o.tedarikci_id.street or ''"/><br/>
                                    <t t-esc="o.tedarikci_id.city or ''"/>, <t t-esc="o.tedarikci_id.country_id.name or ''"/>
                                </t>
                                <t t-else="">
                                    <t t-esc="o.teknik_servis"/>
                                </t>
                            </t>
                        </t>
                        <!-- Diğer durumlar için eski mantık (teknik servis adresi) -->
                        <t t-else="">
                            <t t-if="o.teknik_servis == 'DTL BEYOĞLU'">
                                DTL BEYOĞLU<br/>
                                Şahkulu mh. Nakkas çıkmazı No: 1/1 No:10-46 / 47<br/>
                                Beyoğlu, İstanbul
                            </t>
                            <t t-elif="o.teknik_servis == 'DTL OKMEYDANI'">
                                DTL OKMEYDANI<br/>
                                MAHMUT ŞEVKET PAŞA MAH. ŞAHİNKAYA SOK NO 31 OKMEYDANI<br/>
                                İstanbul
                            </t>
                            <t t-elif="o.teknik_servis == 'ZUHAL ARIZA DEPO'">
                                ZUHAL ARIZA DEPO<br/>
                                Halkalı merkez mh. Dereboyu cd. No:8/B<br/>
                                İstanbul
                            </t>
                            <t t-elif="o.teknik_servis == 'ZUHAL NEFESLİ'">
                                ZUHAL NEFESLİ<br/>
                                Şahkulu, Galip Dede Cd. No:33, 34421 Beyoğlu/İstanbul
                            </t>
                            <t t-elif="o.teknik_servis == 'TEDARİKÇİ' and o.tedarikci_id">
                                <t t-esc="o.tedarikci_id.name"/><br/>
                                <t t-esc="o.tedarikci_id.street or ''"/><br/>
                                <t t-esc="o.tedarikci_id.city or ''"/>, <t t-esc="o.tedarikci_id.country_id.name or ''"/>
                            </t>
                            <t t-else="">
                                <t t-esc="o.teknik_servis"/>
                            </t>
                        </t>
                    </div>
                </div>
            </div>
            
            <!-- Başlık -->
            <div class="row mb-4">
                <div class="col-12">
                    <h2 class="mb-4">ARIZA KAYIT FORMU</h2>
                </div>
            </div>
            
            <!-- Arıza Bilgileri -->
            <div class="row mb-4">
                <div class="col-6">
                    <table class="table">
                        <tr>
                            <td><strong>Arıza No:</strong></td>
                            <td><span t-field="o.name"/></td>
                        </tr>
                        <tr>
                            <td><strong>Tarih:</strong></td>
                            <td><span t-field="o.tarih"/></td>
                        </tr>
                        <tr>
                            <td><strong>İşlem Tipi:</strong></td>
                            <td><span t-field="o.islem_tipi"/></td>
                        </tr>
                        <tr>
                            <td><strong>Arıza Tipi:</strong></td>
                            <td><span t-field="o.ariza_tipi"/></td>
                        </tr>
                        <tr>
                            <td><strong>Teknik Servis:</strong></td>
                            <td><span t-field="o.teknik_servis"/></td>
                        </tr>
                        <tr>
                            <td><strong>Sorumlu:</strong></td>
                            <td><span t-field="o.sorumlu_id"/></td>
                        </tr>
                    </table>
                </div>
                <div class="col-6">
                    <table class="table">
                        <tr>
                            <td><strong>Müşteri:</strong></td>
                            <td>
                                <span t-if="o.partner_id" t-field="o.partner_id"/>
                                <span t-else="">-</span>
                            </td>
                        </tr>
                        <tr>
                            <td><strong>Müşteri Telefon:</strong></td>
                            <td>
                                <span t-if="o.musteri_telefon" t-field="o.musteri_telefon"/>
                                <span t-else="">-</span>
                            </td>
                        </tr>
                        <tr>
                            <td><strong>Ürün:</strong></td>
                            <td><span t-field="o.urun"/></td>
                        </tr>
                        <tr>
                            <td><strong>Model:</strong></td>
                            <td><span t-field="o.model"/></td>
                        </tr>
                        <tr>
                            <td><strong>Marka:</strong></td>
                            <td>
                                <span t-if="o.marka_id" t-field="o.marka_id"/>
                                <span t-elif="o.marka_manu" t-field="o.marka_manu"/>
                                <span t-else="">-</span>
                            </td>
                        </tr>
                        <tr>
                            <td><strong>Fatura Tarihi:</strong></td>
                            <td>
                                <span t-if="o.fatura_tarihi" t-field="o.fatura_tarihi"/>
                                <span t-else="">-</span>
                            </td>
                        </tr>
                        <tr>
                            <td><strong>Durum:</strong></td>
                            <td><span t-field="o.state"/></td>
                        </tr>
                    </table>
                </div>
            </div>
            
            <!-- Arıza Tanımı -->
            <div class="row mb-4">
                <div class="col-12">
                    <h5>Arıza Tanımı:</h5>
                    <div style="border: 1px solid #ddd; padding: 10px; background-color: #f8f9fa; min-height: 60px;">
                        <span t-field="o.ariza_tanimi"/>
                    </div>
                </div>
            </div>
            
            <!-- Onarım Bilgileri -->
            <div class="row mb-4">
                <div class="col-12">
                    <table class="table">
                        <tr>
                            <td><strong>Onarım Bilgisi:</strong></td>
                            <td>
                                <span t-if="o.onarim_bilgisi" t-field="o.onarim_bilgisi"/>
                                <span t-else="">Teknik Servis Tarafından doldurulacaktır</span>
                            </td>
                        </tr>
                        <tr>
                            <td><strong>Onarım Ücreti:</strong></td>
                            <td>
                                <span t-if="o.onarim_ucreti and o.onarim_ucreti > 0">
                                    <span t-field="o.onarim_ucreti"/>
                                </span>
                                <span t-else="">
                                    Teknik Servis Tarafından doldurulacaktır
                                </span>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
            
            <!-- Notlar -->
            <div class="row mb-4" t-if="o.notlar">
                <div class="col-12">
                    <h5>Notlar:</h5>
                    <div style="border: 1px solid #ddd; padding: 10px; background-color: #f8f9fa;">
                        <span t-field="o.notlar"/>
                    </div>
                </div>
            </div>
            
            <!-- Teslim Bilgileri -->
            <div class="row mb-4" t-if="o.state == 'teslim_edildi'">
                <div class="col-12">
                    <h5>Teslim Bilgileri:</h5>
                    <div class="row">
                        <div class="col-6">
                            <table class="table">
                                <tr>
                                    <td><strong>Teslim Alan:</strong></td>
                                    <td>
                                        <span t-if="o.teslim_alan" t-field="o.teslim_alan"/>
                                        <span t-else="">-</span>
                                    </td>
                                </tr>
                                <tr>
                                    <td><strong>Teslim Alan TC:</strong></td>
                                    <td>
                                        <span t-if="o.teslim_alan_tc" t-field="o.teslim_alan_tc"/>
                                        <span t-else="">-</span>
                                    </td>
                                </tr>
                                <tr>
                                    <td><strong>Teslim Alan Telefon:</strong></td>
                                    <td>
                                        <span t-if="o.teslim_alan_telefon" t-field="o.teslim_alan_telefon"/>
                                        <span t-else="">-</span>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div class="col-6">
                            <table class="table">
                                <tr>
                                    <td><strong>Teslim Eden:</strong></td>
                                    <td>
                                        <span t-if="o.sorumlu_id" t-field="o.sorumlu_id"/>
                                        <span t-else="">-</span>
                                    </td>
                                </tr>
                                <tr>
                                    <td><strong>Teslim Tarihi:</strong></td>
                                    <td>
                                        <span t-if="o.write_date" t-field="o.write_date"/>
                                        <span t-else="">-</span>
                                    </td>
                                </tr>
                                <tr>
                                    <td><strong>Teslim Notu:</strong></td>
                                    <td>
                                        <span t-if="o.teslim_notu" t-field="o.teslim_notu"/>
                                        <span t-else="">-</span>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>
</odoo> 